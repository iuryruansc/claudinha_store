<%# views/admin/vendas/partials/form.ejs %>

<form id="venda-form" method="POST" action="<%= action %>">
    <input type="hidden" name="desconto" id="desconto_input" value="0.00">

    <div class="row g-4">
        <div class="col-lg-7">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light"><h5 class="mb-0 fs-5 fw-semibold">ðŸ§¾ Itens da Venda</h5></div>
                <div class="card-body">
                    <div id="itens-venda-placeholder" class="text-center text-muted py-4">
                        <p class="mb-1"><i class="bi bi-cart-x" style="font-size: 2rem;"></i></p>
                        <p class="mb-0">Nenhum produto adicionado.</p>
                    </div>
                    <div id="tabela-itens-wrapper" class="table-responsive" style="display: none;">
                        <table class="table table-sm table-striped table-hover align-middle mb-3">
                            <thead class="table-light">
                                <tr>
                                    <th>Produto</th>
                                    <th style="width: 120px;">Quantidade</th>
                                    <th style="width: 130px;">PreÃ§o Un.</th>
                                    <th style="width: 50px;" class="text-end">AÃ§Ã£o</th>
                                </tr>
                            </thead>
                            <tbody id="itens-venda-container"></tbody>
                        </table>
                    </div>
                    <button type="button" id="add-item-btn" class="btn btn-outline-secondary btn-sm">
                        <i class="bi bi-plus-circle"></i> Adicionar Manualmente
                    </button>
                </div>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light"><h5 class="mb-0 fs-5 fw-semibold">ðŸ’° Resumo de PreÃ§os</h5></div>
                <div class="card-body">
                    <div id="lista-itens-resumo" class="mb-3"></div>
                    <ul class="list-group list-group-flush mb-3">
                        <li class="list-group-item d-flex justify-content-between px-0">
                            <span>Sub-total</span>
                            <strong id="resumo-subtotal-valor">R$ 0,00</strong>
                        </li>
                        <li id="resumo-desconto-linha" class="list-group-item d-flex justify-content-between text-danger px-0 d-none">
                            <span>Desconto</span>
                            <strong id="resumo-desconto-valor">- R$ 0,00</strong>
                        </li>
                    </ul>
                    <div id="global-discount-row">
                        <label class="form-label small text-muted">Aplicar desconto na venda</label>
                        <div class="input-group input-group-sm">
                            <select id="global-discount-type" class="form-select" style="max-width: 80px;"><option value="none" selected>Sem</option><option value="porcentagem">%</option><option value="valor_fixo">R$</option></select>
                            <input id="global-discount-value" type="number" class="form-control" placeholder="0" min="0" step="0.01">
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="fs-6 text-secondary mb-0">Total a Pagar</h5>
                        <h4 class="fs-3 mb-0 text-success fw-bold">R$ <span id="valor_total">0.00</span></h4>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-header"><h5 class="mb-0 fs-5">InformaÃ§Ãµes de Pagamento</h5></div>
                <div class="card-body">
                    <div id="pagamentos-container"></div>
                    <button type="button" id="add-pagamento-btn" class="btn btn-outline-info btn-sm">
                        <i class="bi bi-currency-dollar"></i> Adicionar Pagamento
                    </button>
                </div>
                <div class="card-footer bg-white border-top pt-3">
                    <div class="d-flex justify-content-between mb-2"><h6 class="text-secondary">Total Pago</h6><h5 class="fw-semibold">R$ <span id="total-pago">0.00</span></h5></div>
                    <div class="d-flex justify-content-between mb-2" id="restante-row"><h6 class="text-secondary">Valor Restante</h6><h5 class="fw-semibold">R$ <span id="valor-restante">0.00</span></h5></div>
                    <div class="d-flex justify-content-between d-none" id="troco-row"><h6 class="text-secondary">Troco</h6><h5 class="fw-semibold text-success">R$ <span id="troco">0.00</span></h5></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row my-4">
        <div class="col-12">
            <label for="codigo-input" class="form-label fw-semibold">Leitor de CÃ³digo de Barras</label>
            <div class="input-group input-group-lg">
                <span class="input-group-text"><i class="bi bi-upc-scan"></i></span>
                <input type="text" id="codigo-input" class="form-control" placeholder="Passe o leitor ou digite o cÃ³digo e pressione Enter" autocomplete="off">
            </div>
        </div>
    </div>

    <div class="d-grid mt-4">
        <button type="submit" id="finalizar-venda-btn" class="btn btn-success btn-lg"></button>
    </div>
</form>

<%- include('./modals/venda-modal.ejs') %>

<script>
    window.salesData = {
        produtos: <%- JSON.stringify(produtos) %>,
        formasPagamento: <%- JSON.stringify(formasPagamento) %>
    };
</script>

<script src="/js/venda-form-handler.js" type="module"></script>